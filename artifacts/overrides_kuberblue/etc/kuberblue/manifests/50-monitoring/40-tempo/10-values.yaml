# Tempo Configuration
# Optimized for Kuberblue single-node and small clusters

# Tempo configuration
tempo:
  # Multi-tenancy disabled for simplicity
  multitenancyEnabled: false
  
  # Retention period (7 days)
  retention: 168h
  
  # Storage configuration
  storage:
    trace:
      backend: local
      local:
        path: /var/tempo/traces
      wal:
        path: /var/tempo/wal
  
  # Receiver configuration - accept all common formats
  receivers:
    jaeger:
      protocols:
        thrift_http:
          endpoint: 0.0.0.0:14268
        grpc:
          endpoint: 0.0.0.0:14250
        thrift_binary:
          endpoint: 0.0.0.0:6832
        thrift_compact:
          endpoint: 0.0.0.0:6831
    zipkin:
      endpoint: 0.0.0.0:9411
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318
    opencensus:
      endpoint: 0.0.0.0:55678
  
  # Distributor configuration
  distributor:
    receivers:
      - jaeger
      - zipkin
      - otlp
      - opencensus
  
  # Ingester configuration
  ingester:
    max_block_duration: 30m
    max_block_bytes: 1073741824  # 1GB
  
  # Compactor configuration
  compactor:
    compaction:
      block_retention: 168h  # 7 days
  
  # Query frontend configuration
  query_frontend:
    search:
      max_duration: 168h
  
  # Server configuration  
  server:
    http_listen_port: 3200
    grpc_listen_port: 9095
    log_level: info
  
  # Multi-tenancy disabled for simplicity
  multitenancyEnabled: false
  
  # Ingester configuration
  ingester:
    max_block_duration: 30m
    max_block_bytes: 1073741824

# Readiness probe matches server port (3200)
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "3200"

# Persistence configuration
persistence:
  enabled: true
  size: 20Gi
  storageClass: ""  # Use default

# Resources
resources:
  requests:
    cpu: 25m
    memory: 64Mi
  limits:
    cpu: 100m
    memory: 128Mi

# Service configuration
service:
  type: ClusterIP
  annotations: {}

# Service for OTLP receivers
serviceOtlp:
  enabled: true
  type: ClusterIP

# Service for Jaeger receivers
serviceJaeger:
  enabled: true
  type: ClusterIP

# Service for Zipkin receiver
serviceZipkin:
  enabled: true
  type: ClusterIP

# Monitoring (disabled - Alloy-first architecture)
serviceMonitor:
  enabled: false

# Tempo Query (Jaeger UI compatible)
tempoQuery:
  enabled: true
  repository: grafana/tempo-query
  tag: latest
  pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 12m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 64Mi
  
  service:
    type: ClusterIP
    port: 16686

# Pod Security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 10001
  fsGroup: 10001
  seccompProfile:
    type: RuntimeDefault

# Container Security
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

# Network policies
networkPolicy:
  enabled: false  # Can be enabled based on requirements

# Service Account
serviceAccount:
  create: true
  automountServiceAccountToken: true

# Pod annotations
podAnnotations: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}